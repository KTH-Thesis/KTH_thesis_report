\subsection{Cost function}

\begin{align}
  J_i \big(\overline{\vect{u}}_i (\cdot);\ \vect{z}_i(t_0), \vect{z}_{\mathcal{N}_i}(t_0)\big) &\triangleq
    J_i^U \big(\overline{\vect{u}}_i (\cdot) \big) +
    J_i^Z \big(\vect{z}_i (t_0), \vect{z}_{\mathcal{N}_i}(t_0)\big)
\end{align}

where
\begin{align}
  J_i^U \big(\overline{\vect{u}}_i (\cdot)\big) &\triangleq
    \int_{t_0}^{t_0 + T_p} h_i \big(\overline{\vect{u}}_i (\tau)\big) d \tau \\
  J_i^Z \big(\vect{z}_i (t_0), \vect{z}_{\mathcal{N}_i}(t_0)\big) & \triangleq
    \sum_{j \in \mathcal{N}_i} \Bigg(\int_{t_0}^{t_0 + T_p} g_{ij} \big(\overline{\vect{z}}_i (\tau), \overline{\vect{z}}_j (\tau)\big) d \tau +
    V_{ij} \big(\overline{\vect{z}}_i (t_0 + T_p), \overline{\vect{z}}_j (t_0 + T_p)\big)\Bigg)
\end{align}
\note{without the sum maybe? (just in col form)}
and

\begin{align}
  h_i \big(\vect{u}_i(t) \big)
    &\triangleq \| \vect{u}_i(t)\|_{\mat{R}_i}^2 \\
  g_{ij}\big(\vect{z}_i(t), \vect{z}_j(t)\big)
    & \triangleq \| \vect{z}_i(t) - \vect{z}_j(t) - \vect{z}_{ji,des} \|_{\mat{G}_{ij}}^2 \\
  V_{ij} \big(\vect{z}_i (t_0 + T_p), \vect{z}_j (t_0 + T_p)\big)
    & \triangleq \| \vect{z}_i(t_0 + T_p) - \vect{z}_j(t_0 + T_p) - \vect{z}_{ji,des} \|_{\mat{P}_{ij}}^2
\end{align}\\
Matrices $\mat{R}_i \in \mathbb{R}^{6 \times 6}$ are symmetric and positive
definite, while matrices $\mat{G}_{ij}, \mat{P}_{ij} \in \mathbb{R}^{12 \times 12}$ are
symmetric and positive semi-definite.



\subsection{Optimization problem}

At a generic time $t_0$, agent $i$ solves the following optimization problem:

\begin{align}
  \min\limits_{\overline{\vect{u}}_i (\cdot)}\ &
    J_i \big(\overline{\vect{u}}_i (\cdot);\ \vect{z}_i(t_0), \vect{z}_{\mathcal{N}_i}(t_0)\big) \\
  \text{subject to:} & \\
  & \dot{\overline{\vect{z}}}_i(t) = f_i (\overline{\vect{z}}_i (t), \overline{\vect{u}}_i (t)) \\
  & \overline{\vect{z}}_i (t_0) = \vect{z}_i (t_0) \\
  & \overline{\vect{z}}_j (t_0) = \vect{z}_j (t_0), j \in \mathcal{N}_i \\
  & \overline{\vect{u}}_i(t) \in \mathcal{U}_i,\ j \in \mathcal{N}_i, t \in [t_0, t_0 + T_p)\\
  & \overline{\vect{z}}_i (t) - \overline{\vect{z}}_j (t) - z_{ji, des} \in \mathcal{Z}_i,\ t \in [t_0, t_0 + T_p]\\
  & \overline{\vect{z}}_i (t_0 + T_p) - \overline{\vect{z}}_j (t_0 + T_p) - z_{ji,des} \in \mathcal{Z}_i^f, j \in \mathcal{N}_i \\
  & \|\vect{p}_i(t) - \vect{p}_j(t)\| > \underline{d}_{ij,a}, \forall j \in \mathcal{R}_i(t), t \in [t_0, t_0 + T_p] \\
  & \|\vect{p}_i(t) - \vect{p}_k(t)\| > \underline{d}_{ik,o}, \forall k \in \mathcal{K}, t \in [t_0, t_0 + T_p] \\
  & \|\vect{p}_i(t)\| + r_i < r_W, t \in [t_0, t_0 + T_p] \\
  & \|\vect{p}_i(t) - \vect{p}_j(t)\| < d_i, \forall j \in \mathcal{N}_i, t \in [t_0, t_0 + T_p] \\
  & \theta_i(t) \ne \pm \frac{\pi}{2}, t \in [t_0, t_0 + T_p]
\end{align}

Constraints \ref{}-\ref{} explicitly address the
requirements posed by the problem \eqref{problem}, while the rest exist to
ensure that formation is achieved under constrained input signals.


\begin{gg_box}
\begin{assumption} (Functions $f_i$ are Lipschitz continuous)
  \label{ass:f_i_Lipschitz}
\end{assumption}
\end{gg_box}

\begin{gg_box}
\begin{assumption} (Functions $h_i$ are Lipschitz continuous)
  \label{ass:h_i_Lipschitz}
\end{assumption}
\end{gg_box}

\begin{gg_box}
\begin{assumption} (Functions $g_{ij}$ are Lipschitz continuous)
  \label{ass:g_ij_Lipschitz}
\end{assumption}
\end{gg_box}

\begin{gg_box}
\begin{assumption}

  There exists a local stabilizing controller
  $\vect{\kappa}_i(\vect{x}) \in \mathcal{U}_i$ such that

  \begin{align}
    \dfrac{\partial V_i}{\partial \vect{x}} f_i \Big(\vect{x}(\tau), \vect{\kappa}_i\big(\vect{x}(\tau)\big)\Big) +
      h_i\Big(\vect{x}(\tau), \vect{\kappa}_i \big(\vect{x}(\tau)\big)\Big) \leq 0, \forall \vect{x} \in \Phi_i
  \end{align}

  where $\Phi_i = \{\vect{x} \in \mathbb{R}^n : V_i(\vect{x}) \leq \alpha_i \}$, and
  $\Phi_i \subseteq \mathcal{X}_i^{T_p} = \{x \in \mathbb{R}^n : \vect{\kappa}_i(\vect{x}) \in \mathcal{U}_i\}$

  \label{ass:local_controller_k}
\end{assumption}
\end{gg_box}


\begin{gg_box}
\begin{assumption}

  The terminal costs $V_i(\vect{x})$ are Lipschitz continuous in $\vect{x} \in \Phi_i$
  with Lipschitz constants $L_{V_i}$:

  \begin{align}
    \| V_i(\vect{x}_1) - V_i(\vect{x}_2)\| \leq L_{V_i} \|\vect{x}_1 - \vect{x}_2 \|
  \end{align}

  \label{ass:V_i_Lipschitz}
\end{assumption}
\end{gg_box}


\begin{gg_box}
\begin{assumption}

  The terminal set $\mathcal{X}_{f_i} = \{ \vect{x} \in \mathbb{R}^n : V_i(\vect{x}) \in \alpha_{V_i}\}$
  is such that for all $\vect{x} \in \Phi_i$, $f_i\big(\vect{x}, \vect{\kappa}_i(\vect{x})\big) \in \mathcal{X}_{f_i} \subseteq \Phi_i$.

  \label{ass:x_f_i}
\end{assumption}
\end{gg_box}
