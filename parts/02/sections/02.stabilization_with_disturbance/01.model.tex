\begin{remark}
For the sake of modularity, separability, and direct comparison to the
disturbance-free case, this chapter will assume
that the previous disturbance-free analysis has not been given.
\end{remark}

In this chapter we are interested in steering each agent $i \in \mathcal{V}$
into a \textit{position} in 3D space, while conforming to the requirements
of the problem; that is, all agents should avoid colliding with each other, all
obstacles in the workspace, and the workspace boundary itself, while remaining
in a non-singular configuration and sustaining the connectivity to their
respective neighbours.

%-------------------------------------------------------------------------------
\subsection{Formalizing the model}

We begin by rewriting the system equations \eqref{eq:system_1},
\eqref{eq:system_2} for a generic agent $i \in \mathcal{V}$ in state-space form:
\begin{subequations}
\begin{align}
  \dot{\vect{x}}_i(t) &= \mat{J}_i^{-1}(\vect{x}_i) \vect{v}_i(t) \\
  \dot{\vect{v}}_i(t) &= -\mat{M}_i^{-1}(\vect{x}_i)\mat{C}_i(\vect{x}_i,\dot{\vect{x}}_i) \vect{v}_i(t)
    - \mat{M}_i^{-1}(\vect{x}_i)\vect{g}_i(\vect{x}_i)
    + \mat{M}_i^{-1}(\vect{x}_i)\vect{u}_i(t)
\end{align}
\label{eq:state_space_system_2}
\end{subequations}
where the inversion of $\mat{M}_i$ is possible due to it being
positive-definite $\forall i \in \mathcal{V}$. Denoting by $\vect{z}_i(t)$
\begin{align}
  \vect{z}_i(t) =
    \begin{bmatrix}
      \vect{x}_i(t) \\
      \vect{v}_i(t) \\
    \end{bmatrix},\
    \vect{z}_i(t) : \mathbb{R}_{\geq 0} \to \mathbb{R}^9 \times \mathbb{T}^3
\end{align}
and
$\dot{\vect{x}}_i(t)$ and $\dot{\vect{v}}_i(t)$ by
\begin{subequations}
\begin{align}
  \dot{\vect{x}}_i(t) &= f_{i,x}(\vect{z}_i, \vect{u}_i) \\
  \dot{\vect{v}}_i(t) &= f_{i,v}(\vect{z}_i, \vect{u}_i)
\end{align}
\end{subequations}
we get the compact representation of the system's model
\begin{align}
  \dot{\vect{z}}_i(t) =
    \begin{bmatrix}
      f_{i,x}(\vect{z}_i, \vect{u}_i) \\
      f_{i,v}(\vect{z}_i, \vect{u}_i)
    \end{bmatrix} =
 f_i \big(\vect{z}_i (t), \vect{u}_i (t)\big)
\end{align}
The state evolution of agent $i$ is modeled by a system of non-linear
continuous-time differential equations of the form
\begin{align}
  \dot{\vect{z}}_i(t) &= f_i \big(\vect{z}_i (t), \vect{u}_i (t)\big) \label{eq:non_perturbed_system_2}\\
  \vect{z}_i(0) &= \vect{z}_{i,0} \\
  \vect{z}_i (t) & \subset \mathbb{R}^{9} \times \mathbb{T}^3 \\
  \vect{u}_i (t) & \subset \mathbb{R}^6
\end{align}
where state $\vect{z}_i$ is directly measurable. It should be noted that
equation \eqref{eq:non_perturbed_system_2} does not consider model-plant
mismatches or external disturbances. We assume that the real system is
subject to bounded additive disturbances $\vect{\delta}_i$ such that
$\vect{\delta}_i \in \Delta_i \subset \mathbb{R}^9 \times \mathbb{T}^3$, where
$\Delta_i$ is a compact set containing the origin.
The real system is described by:
\begin{align}
  \dot{\vect{z}}_i(t) &= f_i^R \big(\vect{z}_i (t), \vect{u}_i (t)\big) \label{eq:perturbed_system} \\
                      &= f_i \big(\vect{z}_i (t), \vect{u}_i (t)\big) + \vect{\delta}_i(t) \\
  \vect{z}_i(0) &= \vect{z}_{i,0} \\
  \vect{z}_i (t) & \subset \mathbb{R}^{9} \times \mathbb{T}^3 \\
  \vect{u}_i (t) & \subset \mathbb{R}^6 \\
  \vect{\delta}_i(t) &\in \Delta_i \subset \mathbb{R}^9 \times \mathbb{T}^3,\ t \in \mathbb{R}_{\geq 0}\\
  \text{sup}\limits_{t \in \mathbb{R}_{\geq 0}} \|\vect{\delta}_i(t)\| &\leq \overline{\delta}_i
\end{align}

We define the set $\mathcal{Z}_i \subset \mathbb{R}^{9} \times \mathbb{T}^3$
as the set that captures all the state constraints of the system's dynamics
posed by the problem \eqref{problem}, for $t \in \mathbb{R}_{\geq 0}$.
Therefore $\mathcal{Z}_i$ is such that:
\begin{align}
  \mathcal{Z}_i = \big\{\vect{z}_i(t) \in \mathbb{R}^{9}\times \mathbb{T}^3 : \
      & \|\vect{p}_i(t) - \vect{p}_j(t)\| > \underline{d}_{ij,a}, \forall j \in \mathcal{R}_i(t), \label{constraint:p_1_2}\\
      & \|\vect{p}_i(t) - \vect{p}_j(t)\| < d_i, \forall j \in \mathcal{N}_i, \\
      & \|\vect{p}_i(t) - \vect{p}_{\ell}\| > \underline{d}_{i\ell,o}, \forall \ell \in \mathcal{L}, \\
      & \|\vect{p}_W - \vect{p}_i(t)\| < \overline{d}_{i,W}, \\
      & - \frac{\pi}{2} < \theta_i(t) < \frac{\pi}{2} \label{constraint:p_5_2}, \\
      &\forall t \in \mathbb{R}_{\geq 0}\big\}
\end{align}
