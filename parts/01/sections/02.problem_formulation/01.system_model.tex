%-------------------------------------------------------------------------------
\subsection{System Model}

Consider a set of $N$ rigid bodies, with $\mathcal{V} = \{ 1,2, \ldots, N\}$,
$N  \geq 2$, operating in a workspace $W\subseteq \mathbb{R}^3$.
A coordinate frame $\{i\}, i\in\mathcal{V}$ is attached to each body's
center of mass. The workspace is assumed to be modeled as a
bounded sphere $\mathcal{B}(\vect{p}_W,r_W)$ expressed in an inertial frame
$\{\mathcal{O}\}$.

We consider that over time $t$ each agent $i$ occupies the space of a sphere
$\mathcal{B}(\vect{p}_i(t), r_i)$, where $\vect{p}_i : \mathbb{R}_{\geq 0} \to \mathbb{R}^3$
is the position of the agent's center of mass, and $r_i < r_W$ is the radius of the
agent's body. We denote $\vect{q}_i(t):\mathbb{R}_{\geq 0} \to \mathbb{T}^3, i\in\mathcal{V}$,
the Euler angles representing the agents' orientation with respect to the
inertial frame $\{\mathcal{O}\}$,
with $\vect{q}_i \triangleq [\phi_i,\theta_i,\psi_i]^{\top}$, where
$\phi_i, \psi_i \in [-\pi, \pi]$ and
$\theta_i \in [-\frac{\pi}{2}, \frac{\pi}{2}]$. We define
$$\vect{x}_i \triangleq [\vect{p}^{\top}_i,\vect{q}^{\top}_i]^{\top},
\vect{x}_i:\mathbb{R}_{\geq 0} \to \mathbb{R}^3\times \mathbb{T}^3 \equiv \mathbb{M}$$
$$\vect{v}_i \triangleq [\dot{\vect{p}}^{\top}_i, \vect{\omega}^{\top}_i]^{\top},
\vect{v}_i : \mathbb{R}_{\geq 0} \to \mathbb{R}^3\times \mathbb{R}^3 \equiv \mathbb{R}^6$$
and model the motion of agent $i$ under second order dynamics:

\begin{subequations}
	\begin{align}
    \dot{\vect{x}}_i(t) &= \mat{J}_i^{-1}(\vect{x}_i) \vect{v}_i(t), \label{eq:system_1} \\
    \vect{u}_i &= \mat{M}_i(\vect{x}_i) \dot{\vect{v}}_i(t) + \mat{C}_i(\vect{x}_i,\dot{\vect{x}}_i) \vect{v}_i(t)+\vect{g}_i(\vect{x}_i), \label{eq:system_2}
	\end{align}
  \label{eq:system}
\end{subequations}

In equation \eqref{eq:system_1}, $\mat{J}_i:\mathbb{T}^3 \to \mathbb{R}^{6\times6}$ is
a Jacobian matrix that maps the non-orthogonal Euler angle rates to the
orthogonal angular velocities $\vect{v}_i$:

\begin{equation}
  \mat{J}_i(\vect{x}_i) =
  \begin{bmatrix}
    \mat{I}_3 & \mat{0}_{3 \times 3} \\
    \mat{0}_{3 \times 3} & \mat{J}_{ q }(\vect{x}_i) \\
  \end{bmatrix} \notag, \text{ with }
  \mat{J}_q(\vect{x}_i) =
  \begin{bmatrix}
    1 & 0 & -\sin\theta_i \\
    0 & \cos\phi_i & \cos\theta_i \sin\phi_i \\
    0 & - \sin\phi_i & \cos\phi_i \cos\theta_i
  \end{bmatrix} \notag
\end{equation}

The matrix $\mat{J}_i$ is singular when $det(\mat{J}_i)$ $=$ $\cos\theta_i = 0$
$\Leftrightarrow$ $\theta_i$ $=$ $\pm \frac{\pi}{2}$. The control scheme
proposed in this thesis guarantees that this is always avoided, and hence
equation \eqref{eq:system_1} is well defined. This gives rise to the following
remark:

\begin{bw_box}
  \begin{remark}
    $det(\mat{J}_i) = \cos\theta_i \leq 1$, $\forall i \in \mathcal{V}$
  \end{remark}
\end{bw_box}



In equation \eqref{eq:system_2}, $\mat{M}_i:\mathbb{M} \to \mathbb{R}^{6\times6}$ is
the symmetric and positive definite \textit{inertia matrix},
$\mat{C}_i:\mathbb{M}\times\mathbb{R}^6 \to \mathbb{R}^{6\times6}$ is the
\textit{Coriolis matrix} and $\vect{g}_i:\mathbb{M} \to \mathbb{R}^6$ is the
\textit{gravity vector}.
Finally, $\vect{u}_i\in\mathbb{R}^6$ is the control input vector representing
the $6$D generalized \textit{actuation force} acting on the agent.

%Let us also define the vectors
%$\vect{X} = [\vect{x}_1^\top, \dots, x_N^\top]^\top :
%\mathbb{R}_{\geq 0} \to \mathbb{M}^N, \vect{V} = [\vect{v}_1^\top, \dots
%\vect{v}_N^\top]^\top: \mathbb{R}_{\geq 0} \to \mathbb{R}^{6N}$.


\begin{bw_box}
  \begin{remark}
    According to \cite{Murray:1994:MIR:561828}, the matrices
    $\dot{\mat{M}}_i - 2\mat{C}_i, i \in \mathcal{V}$ are skew-symmetric.
    The quadratic form of a skew-symmetric matrix is always equal to 0, hence:

    \begin{equation}
      \vect{y}^\top \left[\dot{\mat{M}}_i - 2 \mat{C}_i\right]\vect{y} = 0,
        \forall \vect{y} \in \mathbb{R}^6, i \in \mathcal{V}.
    \label{eq:skew_symm}
    \end{equation}
  \end{remark}
\end{bw_box}

However, access to measurements of, or knowledge about these matrices and
vectors was not considered up until now. At this point we make the following
assumption:

\begin{gg_box}
  \begin{assumption} (\textit{Measurements and Access to Information Assumption
    from an Inter-agent Perspective})
  \begin{enumerate}

    \item Agent $i$ has access to measurements
      $\vect{p}_i, \vect{q}_i, \dot{\vect{p}}_i, \vect{\omega}_i, i\in\mathcal{V}$,
      that is, vectors $\vect{x}_i, \vect{v}_i$ pertaining to himself,

    \item Agent $i$ has a (upper-bounded) sensing range $d_i$ such that
      $$d_i > \max\{r_i + r_j : \forall i,j \in \mathcal{V}, i \neq j\}$$

    \item the inertia $\mat{M}$ and Coriolis $\mat{C}$ vector fields are
      bounded and unknown

    \item the gravity vectors $\vect{g}$ are bounded and known

  \end{enumerate}
  \label{ass:measurements_access}
\end{assumption}
\end{gg_box}

The consequence of points 1 and 2 is that, by defining the set of
agents $j$ that are within the sensing range of agent $i$ at time $t$ as
$$\mathcal{R}_i(t) \triangleq \{j\in\mathcal{V} : \vect{p}_j(t)\in\mathcal{B}(\vect{p}_i(t), d_i)\}$$
or equivalently
$$\mathcal{R}_i(t) \triangleq \{j\in\mathcal{V} : \| \vect{p}_i(t) - \vect{p}_j(t) \| \leq d_i\}$$
agent $i$ also knows at each time instant $t$ all
$$\vect{p}_{j \triangleright i}(t), \vect{q}_{j \triangleright i}(t),
\dot{\vect{p}}_{j \triangleright i}(t), \vect{\omega}_{j \triangleright i}(t)$$
Therefore, agent $i$ assumes access to all measurements
$$\vect{p}_{j}(t), \vect{q}_{j}(t), \dot{\vect{p}}_j(t),
\vect{\omega}_j(t),\ \forall j\in \mathcal{R}_i(t),t\in\mathbb{R}_{\geq 0}$$
of agent $j$ by virtue of being able to calculate them using knowledge of its own
$\vect{p}_i(t)$, $\vect{q}_i(t)$, $\dot{\vect{p}}_i(t)$, $\vect{\omega}_i(t)$.


In the workspace there are $|\mathcal{L}|$ \textit{static obstacles},
also modeled as spheres, with centers at positions
$\vect{p}_{\ell} \in \mathbb{R}^3$ with radii
$r_{\ell}\in \mathbb{R}$, $\ell \in \mathcal{L} = \{1,\dots,|\mathcal{L}| \}$.
Thus, the obstacles are modeled by spheres
$\mathcal{B}(\vect{p}_{\ell}, r_{\ell})$, $\ell \in \{1,\dots,|\mathcal{L}|\}$.
The geometry of two agents $i$ and $j$ as well as an obstacle
$\ell$ in workspace $W$ is depicted in Fig. \ref{fig:two_agents_one_obstacle}.\\

\begin{figure}[ht!]
	\centering
    \input{figures/03.problem_formulation/two_agents_one_obstacle.tex}
    \caption{Illustration of two agents $i, j \in \mathcal{V}$ and an static
      obstacle $\ell \in \mathcal{L}$ in the workspace; $\{\mathcal{O}\}$ is the inertial
      frame, $\{i\}, \{j\}$ are the frames attached to the agents' center of
      mass, $\vect{p}_i, \vect{p}_j, \vect{p}_{\ell} \in \mathbb{R}^3$ are the
      positions of the center of mass of the agents $i,j$ and the
      obstacle $\ell$ respectively, expressed in frame
      $\{\mathcal{O}\}$. $r_i, r_j, r_{\ell}$ are the radii of the agents $i,j$
      and the obstacle $\ell$ respectively. $d_i, d_j$ with
      $d_i > d_j$ are the agents' sensing ranges.
      In this figure, agents $i$ and $j$ are not neighbours, since the center
      of mass of agent $j$ is not within the sensing range of agent $i$ and vice
      versa: $\vect{p}_j \notin \mathcal{B}(\vect{p}_i(t), d_i)$ and
      $\vect{p}_i \notin \mathcal{B}(\vect{p}_j(t), d_j)$.}
	\label{fig:two_agents_one_obstacle}
\end{figure}

Let us now define the distance between any two agents $i,j$ as
$d_{ij,a}$, that between agent $i$ and obstacle $\ell$ as $d_{i\ell,o}$,
and that between an agent $i$ and the origin of the workspace $W$ as
$d_{i,W}$, with $d_{ij,a}, d_{i\ell,o}, d_{i,W} : \mathbb{R}^3 \to \mathbb{R}_{\geq 0}$:
\begin{subequations}
	\begin{align}
    d_{ij,a}(t) &\triangleq \| \vect{p}_i(t) - \vect{p}_j(t) \|, \\
    d_{i\ell,o}(t) &\triangleq \| \vect{p}_i(t) - \vect{p}_\ell(t) \|, \\
    d_{i,W}(t) &\triangleq \| \vect{p}_W - \vect{p}_i(t) \|
	\end{align}
\end{subequations}
as well as constants
\begin{subequations}
	\begin{align}
    \underline{d}_{ij, a} &\triangleq r_{i} + r_{j}, \\
    \underline{d}_{i\ell, o} &\triangleq r_{i} + r_{\ell} \\
    \overline{d}_{i,W} &\triangleq r_W - r_i
	\end{align}
\end{subequations}
$\forall i, j \in \mathcal{V}$, $i \neq j$, $\ell \in \mathcal{L}$.
The latter stand for the minimum distance between two \textit{agents}, the
minimum distance between an \textit{agent} and an \textit{obstacle},
and the maximum distance between an \textit{agent} and the origin of the
workspace, respectively. They arise spatially as physical limitations and will
be utilized in collision-avoidance constraints.

Based on these definitions, we will now define the concept of a
\textit{collision-free configuration}:
\begin{bw_box}
\begin{definition} (\textit{Collision-free Configuration})

  A collision-free configuration between
  \begin{itemize}
    \item any two agents $i,j \in \mathcal{V}$, is when $d_{ij,a}(t) > \underline{d}_{ij,a}$
    \item an agent $i \in \mathcal{V}$ and an obstacle $\ell \in \mathcal{L}$,
     is when $d_{il,o}(t) > \underline{d}_{il,o}$
    \item an agent $i \in \mathcal{V}$ and the workspace $W$ boundary,
     is when $d_{i,W}(t) < \overline{d}_{i,W}$
  \end{itemize}
  at a generic time instant $t$. When all three conditions are met, we will
  simply refer to the overall configuration as a collision-free configuration.
\end{definition}
\end{bw_box}
