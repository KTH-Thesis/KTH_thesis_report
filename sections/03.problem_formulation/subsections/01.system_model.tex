\subsection{System Model}

Consider a set of $N$ rigid bodies, with $\mathcal{V} = \{ 1,2, \ldots, N\}$,
$N  \geq 2$, operating in a workspace $W\subseteq \mathbb{R}^3$.
A coordinate frame $\{i\}, i\in\mathcal{V}$ is attached to each body's
center of mass. The workspace is assumed to be modeled as a
bounded sphere $\mathcal{B}(\vect{0},r_W)$ expressed in an inertial frame
$\{\mathcal{O}\}$.

We consider that over time $t$ each agent $i$ occupies the space of a sphere
$\mathcal{B}(\vect{p}_i(t), r_i)$, where $\vect{p}_i : \mathbb{R}_{\geq 0} \to \mathbb{R}^3$
is the position of the agent's center of mass, and $r_i < r_W$ is the radius of the
agent's body. We denote $\vect{q}_i(t):\mathbb{R}_{\geq 0} \to \mathbb{T}^3, i\in\mathcal{V}$,
the Euler angles representing the agents' orientation with respect to the
inertial frame $\{\mathcal{O}\}$,
with $\vect{q}_i \triangleq [\phi_i,\theta_i,\psi_i]^{\top}$.
We define
$$\vect{x}_i \triangleq [\vect{p}^{\top}_i,\vect{q}^{\top}_i]^{\top},
\vect{x}_i:\mathbb{R}_{\geq 0} \to \mathbb{R}^3\times \mathbb{T}^3 \equiv \mathbb{M}$$
$$\vect{v}_i \triangleq [\dot{\vect{p}}^{\top}_i, \vect{\omega}^{\top}_i]^{\top},
\vect{v}_i : \mathbb{R}_{\geq 0} \to \mathbb{R}^3\times \mathbb{R}^3 \equiv \mathbb{R}^6$$
and model the motion of agent $i$ under second order dynamics:

\begin{subequations}
	\begin{align}
    \dot{\vect{x}}_i(t) &= \mat{J}_i^{-1}(\vect{x}_i) \vect{v}_i(t), \label{eq:system_1} \\
    \vect{u}_i &= \mat{M}_i(\vect{x}_i) \dot{\vect{v}}_i(t) + \mat{C}_i(\vect{x}_i,\dot{\vect{x}}_i) \vect{v}_i(t)+\vect{g}_i(\vect{x}_i), \label{eq:system_2}
	\end{align}
  \label{eq:system}
\end{subequations}

In equation \eqref{eq:system_1}, $\mat{J}_i:\mathbb{T}^3 \to \mathbb{R}^{6\times6}$ is
a Jacobian matrix that maps the non-orthogonal Euler angle rates to the
orthogonal angular velocities $\vect{v}_i$:

\begin{equation}
  \mat{J}_i(\vect{x}_i) =
  \begin{bmatrix}
    \mat{I}_3 & \mat{0}_{3 \times 3} \\
    \mat{0}_{3 \times 3} & \mat{J}_{ q }(\vect{x}_i) \\
  \end{bmatrix} \notag, \text{ with }
  \mat{J}_q(\vect{x}_i) =
  \begin{bmatrix}
    1 & 0 & -\sin\theta_i \\
    0 & \cos\phi_i & \cos\theta_i \sin\phi_i \\
    0 & - \sin\phi_i & \cos\phi_i \cos\theta_i
  \end{bmatrix} \notag
\end{equation}

The matrix $\mat{J}_i$ is singular when $det(\mat{J}_i)$ $=$ $\cos\theta_i = 0$
$\Leftrightarrow$ $\theta_i$ $=$ $\pm \frac{\pi}{2}$. The controller
proposed in this thesis guarantees that this is always avoided, and hence
equation \eqref{eq:system_1} is well defined. This gives rise to the following
remark:

\begin{bw_box}
  \begin{remark}
    $det(\mat{J}_i) = \cos\theta_i \leq 1$, $\forall i \in \mathcal{V}$
  \end{remark}
\end{bw_box}

\begin{figure}[ht!]
	\centering
    \input{figures/03.problem_formulation/two_agents_one_obstacle.tex}
    \caption{Illustration of two agents $i, j \in \mathcal{V}$ and an static
      obstacle $k \in \mathcal{K}$ in the workspace; $\{\mathcal{O}\}$ is the inertial
      frame, $\{i\}, \{j\}$ are the frames attached to the agents' center of
      mass, $\vect{p}_i, \vect{p}_j, \vect{p}_{k} \in \mathbb{R}^3$ are the
      positions of the center of mass of the agents $i,j$ and the
      obstacle $k$ respectively, expressed in frame
      $\{\mathcal{O}\}$. $r_i, r_j, r_{k}$ are the radii of the agents $i,j$
      and the obstacle $k$ respectively. $d_i, d_j$ with
      $d_i > d_j$ are the agents' sensing ranges.
      In this figure, agents $i$ and $j$ are not neighbours, since the center
      of mass of agent $j$ is not within the sensing range of agent $i$ and vice
      versa: $\vect{p}_j \notin \mathcal{B}(\vect{p}_i(t), d_i)$ and
      $\vect{p}_i \notin \mathcal{B}(\vect{p}_j(t), d_j)$.}
	\label{fig:two_agents_one_obstacle}
\end{figure}

In equation \eqref{eq:system_2}, $\mat{M}_i:\mathbb{M} \to \mathbb{R}^{6\times6}$ is
the symmetric and positive definite \textit{inertia matrix},
$\mat{C}_i:\mathbb{M}\times\mathbb{R}^6 \to \mathbb{R}^{6\times6}$ is the
\textit{Coriolis matrix} and $\vect{g}_i:\mathbb{M} \to \mathbb{R}^6$ is the
\textit{gravity vector}.
Finally, $\vect{u}_i\in\mathbb{R}^6$ is the control input vector representing
the $6$D generalized \textit{actuation force} acting on the agent.

%Let us also define the vectors
%$\vect{X} = [\vect{x}_1^\top, \dots, x_N^\top]^\top :
%\mathbb{R}_{\geq 0} \to \mathbb{M}^N, \vect{V} = [\vect{v}_1^\top, \dots
%\vect{v}_N^\top]^\top: \mathbb{R}_{\geq 0} \to \mathbb{R}^{6N}$.


\begin{bw_box}
  \begin{remark}
    According to \cite{Siciliano2009}, the matrices
    $\dot{\mat{M}}_i - 2\mat{C}_i, i \in \mathcal{V}$ are skew-symmetric.
    The quadratic form of a skew-symmetric matrix is always equal to 0
    \cite{horn_jonshon}, hence:

    \begin{equation}
      \vect{y}^\top \left[\dot{\mat{M}}_i - 2 \mat{C}_i\right]\vect{y} = 0,
        \forall \vect{y} \in \mathbb{R}^n, i \in \mathcal{V}.
    \label{eq:skew_symm}
    \end{equation}
  \end{remark}
\end{bw_box}

However, access to measurements of, or knowledge about these matrices and
vectors was not considered up until now. At this point we make the following
assumption:

\begin{gg_box}
\begin{assumption} (Measurements and Access to Information Assumption From an
  Inter-agent Perspective)
  \begin{enumerate}

    \item Agent $i$ has access to measurements
      $\vect{p}_i, \vect{q}_i, \dot{\vect{p}}_i, \vect{\omega}_i, i\in\mathcal{V}$,
      that is, vectors $\vect{x}_i, \vect{v}_i$ pertaining to himself,

    \item Agent $i$ has a (upper-bounded) sensing range $d_i$ such that
      $$d_i > \max\{r_i + r_j : \forall i,j \in \mathcal{V}, i \neq j\}$$

    \item the inertia $\mat{M}$ and Coriolis $\mat{C}$ vector fields are
      bounded and unknown

    \item the gravity vectors $\vect{g}$ are bounded and known

  \end{enumerate}
  \label{ass:measurements_access}
\end{assumption}
\end{gg_box}

The consequence of points 1 and 2 is that, by defining the set of
agents $j$ that are within the sensing range of agent $i$ at time $t$ as
$$\mathcal{R}_i(t) \triangleq \{j\in\mathcal{V} : \vect{p}_j(t)\in\mathcal{B}(\vect{p}_i(t), d_i)\}$$
or equivalently
$$\mathcal{R}_i(t) \triangleq \{j\in\mathcal{V} : \| \vect{p}_i(t) - \vect{p}_j(t) \| \leq d_i\}$$
agent $i$ also knows at each time instant $t$ all
$$\vect{p}_{j \triangleright i}(t), \vect{q}_{j \triangleright i}(t),
\dot{\vect{p}}_{j \triangleright i}(t), \vect{\omega}_{j \triangleright i}(t)$$
Therefore, agent $i$ assumes access to all measurements
$$\vect{p}_{j}(t), \vect{q}_{j}(t), \dot{\vect{p}}_j(t),
\vect{\omega}_j(t), \forall j\in \mathcal{R}_i(t),t\in\mathbb{R}_{\geq 0}$$
of agent $j$ by virtue of being able to calculate them using knowledge of its own
$\vect{p}_i(t)$, $\vect{q}_i(t)$, $\dot{\vect{p}}_i(t)$, $\vect{\omega}_i(t)$.



In the workspace there are $|\mathcal{K}|$ \textit{static obstacles}, modeled as
spheres with centers at positions $\vect{p}_{k}$ with radii
$r_{k}\in \mathbb{R}^3, k \in \mathcal{K} = \{1,\dots,|\mathcal{K}| \}$.
Thus, the obstacles are modeled by the spheres
$\mathcal{B}(\vect{p}_{k}, r_{k}), k \in \{1,\dots,|\mathcal{K}|\}$. The geometry in
workspace $W$ of two agents $i$ and $j$ as well as an obstacle $k$ is depicted
in Fig. \ref{fig:two_agents_one_obstacle}.

Let us also define the distance between any two agents $i,j$ as
$d_{ij,a}: \mathbb{R}^6 \to \mathbb{R}_{\geq 0}$, and that between agent $i$
and obstacle $k$ as $d_{ik,o} : \mathbb{R}^3 \to \mathbb{R}_{\geq 0}$:

\begin{subequations}
	\begin{align}
    d_{ij,a}(t) &\triangleq \| \vect{p}_i(t) - \vect{p}_j(t) \|, \\
    d_{ik,o}(t) &\triangleq \| \vect{p}_i(t) - \vect{p}_k(t) \|
	\end{align}
\end{subequations}

$\forall i, j \in \mathcal{V}, i \neq j, k \in \mathcal{K}$, as well as
constants $\underline{d}_{ij, a} \triangleq r_{i} + r_{j},
\underline{d}_{ik, o} \triangleq r_{i} + r_{o_k}$. The latter stand for
the minimum distance between two agents, and the minimum distance between an
agent and an obstacle. These arise spatially as physical limitations and will
be utilized as collision-avoidance constraints.

The \textit{topology} of the multi-agent network is modeled through the graph
$\mathcal{G} = (\mathcal{V},\mathcal{E})$, with $\mathcal{V}=\{1,\dots,N\}$ and

\begin{align}
\mathcal{E} \triangleq \big\{\{i,j\}\in\mathcal{V}\times\mathcal{V} :
  i \neq j,
  j\in\mathcal{N}_i(0) \subseteq \mathcal{R}_i(0) \text{ and }
  i \in \mathcal{N}_j(0) \subseteq \mathcal{R}_j(0) \big\}
  \label{eq:edges_set}
\end{align}

Agents $j \in \mathcal{N}_i(0)$ are defined as the \textit{neighbours} of
agent $i$. They are the set of indices of agents $j \in \mathcal{V}$ which

\begin{enumerate}
  \item are within the sensing range of agent $i$ at time $t=0$, i.e.
    $j \in \mathcal{R}_i(0)$, and
  \item are intended to be kept within the sensing range of agent $i$ at all
    times $t \in \mathbb{R}_{> 0}$
\end{enumerate}

Therefore, while the composition of the set $\mathcal{R}_i(t)$ evolves and
varies through time in general, the set $\mathcal{N}_i(t)$ should remain
constant through time. That means that we consider that the connected graph
$\mathcal{G}$ is static, in the sense that no edges are added to it through
time. We do not exclude, however, edge removal through connectivity loss between
initially neighboring agents, which we guarantee to avoid, as presented in the
sequel.

Definition \eqref{eq:edges_set} implies that the graph is undirected, i.e.,
\begin{align}
  d_{ij,a}(0) &< d_i, \forall i \in \mathcal{V}, j \in \mathcal{N}_i(0) \label{eq:initially_connected_0} \\
  d_{ji,a}(0) &< d_j, \forall j \in \mathcal{V}, i \in \mathcal{N}_j(0) \label{eq:initially_connected_1}
\end{align}

It is also assumed that at $t=0$ the neighboring agents are in a
\textit{collision-free configuration}, i.e.

\begin{equation}
  \underline{d}_{ij, a} < d_{ij,a}(0), \forall i,j \in \mathcal{V}, i \neq j
\label{eq:initially_coll_free}
\end{equation}

Furthermore, it is assumed that, initially, the Jacobians $\mat{J}_i$ are
well-defined $\forall i \in \mathcal{V}$. These four assumptions, which concern
the initial conditions of the problem, are summarized in assumption
\ref{ass:initial_conditions}:

\begin{gg_box}
\begin{assumption}(Initial Conditions Assumption)\\

  At time $t = 0$

  \begin{enumerate}

	  \item the communication graph $\mathcal{G}$ is connected,

    \item all agents are in a collision-free configuration:

      $$\underline{d}_{ij,a} < d_{ij,a}(0) < d_i$$

    \item all agents are in a singularity-free configuration:

      $$\theta_i(0) \neq \pm \frac{\pi}{2}$$

  \end{enumerate}
  $\forall i \in \mathcal{V}$ and all agents $j$ within the sensing range of $i$.
  \label{ass:initial_conditions}
\end{assumption}
\end{gg_box}


As for $t \geq 0$, agent $i$ is in a collision-and-singularity-free
configuration, and is connected to the neighbours it had at time $t = 0$,
when
$$\sum_{j \in \mathcal{N}_i(0)} \| \vect{x}_i(t) - \vect{x}_j(t) - \vect{x}_{ji,des}\| < \mu_i,
\forall i \in \mathcal{V}$$
where $\mu_i$ is an arbitrarily small positive constant. Intuitively, this
means that when the agents reach very close to their desired formation, they
will be sufficiently away from collisions, connectivity losses and singular
configurations. In particular, this concerns collisions between an agent and
an obstacle or the workspace boundary (inter-agent collisions and connectivity
losses are avoided by choosing feasible formation displacements $p_{ij,des}$),
and singular configurations. In other words, the multi-agent formation should be
performed sufficiently away from obstacles and the workspace boundary.

The desired steady-state displacements
$\vect{x}_{ij,des}$ $=$ $[\vect{p}_{ij,des}^{\top}, \vect{q}_{ij,des}^{\top}]^{\top}$
are themselves \textit{feasible} if $\forall i \in \mathcal{V}$,
$j \in \mathcal{N}_i(0)$,
$$\bigcap \{(\vect{x}_i, \vect{x}_j) \in W^{N_i + 1} : \| \vect{x}_i - \vect{x}_j - \vect{x}_{ij,des} \| = 0 \}
\ne \varnothing$$
At this point, let us define $d_o$
\begin{align*}
  d_o &\triangleq \min\{\| \vect{p}_{k} - \vect{p}_{k'}\| : k,k' \in \mathcal{K}, k \neq k' \},
\end{align*}
as the distance between the two least distant obstacles in the workspace,
$d_{o,W}$
\begin{align*}
  d_{o,W} & \triangleq \min\{r_W - \left( r_{k} + \| \vect{p}_{k} \| \right) : k \in \mathcal{K}\},
\end{align*}
as the distance between the least distant obstacle from the boundary of the
workspace and the boundary itself, $D$
\begin{equation*}
  D \triangleq \min\{d_o, d_{o,W}\}
\end{equation*}
as the least of these two distances, and $\Delta$
\begin{align*}
  \hspace{-2mm} \Delta \triangleq \max\Big\{&d_{ij, a}+r_i+r_j: i, j \in \mathcal{V}, i \neq j, \notag \\
  &\hspace{-2mm} \| \vect{p}_k - \vect{p}_\ell \| = \vect{p}_{k \ell,\text{des}}, \\
  &\|\vect{q}_k - \vect{q}_\ell\| = \vect{q}_{k \ell,\text{des}}, \\
  &k \in \mathcal{V}, \ell \in \mathcal{N}_k(0)\Big\}
\end{align*}
as the \emph{diameter of formation}. $\Delta$ is the distance between the two
most distant agents when formation is achieved. Given these notions, we
can state an assumption on the feasibility of a solution to the problem
that this thesis addresses:

\begin{gg_box}
\begin{assumption}(After-formation Geometric Assumption)

	\begin{itemize}
		\item When the multi-agent system reaches the desired formation, it should
      be able to pass between two of the obstacles and between an
      obstacle and the boundary of the workspace.
      Thus, it is required that $D > \Delta$.
		\item As a consequence, at the very least, all agents should be able to
      pass between any two obstacles and between all obstacles and the
      boundary of the workspace, without, simultaneously, any of them
      colliding with each other or with the obstacles or the boundary of the
      workspace.
      Thus, it is required that $D >  \sum_{i \in \mathcal{V}}^{} 2r_i$.
	\end{itemize}

	These geometric assumptions can be summarized in the following
  inequality:

	\begin{equation}
    D > \max\left\{\Delta, \sum_{i \in \mathcal{V}}^{} 2r_i \right\}
  \label{eq:geometric_constraint}
	\end{equation}

\label{ass:after_formation_geometry}
\end{assumption}
\end{gg_box}
