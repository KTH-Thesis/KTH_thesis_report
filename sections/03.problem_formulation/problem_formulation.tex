\subsection{System Model}

Consider a set of $N$ rigid bodies, with $\mathcal{V} = \{ 1,2, \ldots, N\}$,
$N  \geq 2$, operating in a workspace $W\subseteq \mathbb{R}^3$.
A coordinate frame $\{i\}, i\in\mathcal{V}$ is attached to each body's
center of mass. The workspace is assumed to be modeled as a
bounded sphere $\mathcal{B}(\vect{0},r_W)$ expressed in an inertial frame
$\{\mathcal{O}\}$.

We consider that over time $t$ each agent $i$ occupies the space of a sphere
$\mathcal{B}(\vect{p}_i(t), r_i)$, where $\vect{p}_i : \mathbb{R}_{\geq 0} \to \mathbb{R}^3$
is the position of the agent's center of mass, and $r_i$ is the radius of the
agent's body. We denote by $\vect{q}_i(t):\mathbb{R}_{\geq 0} \to \mathbb{T}^3, i\in\mathcal{V}$,
the Euler angles representing the agents' orientation,
with $\vect{q}_i = [\phi_i,\theta_i,\psi_i]^{\top}$.
We define $\vect{x}_i = [\vect{p}^{\top},\vect{q}^{\top}_i]^{\top},
\vect{v}_i =[\dot{\vect{p}}^{\top}_i, \vect{\omega}^{\top}_i]^{\top}$,
$\vect{x}_i:\mathbb{R}_{\geq 0} \to \mathbb{R}^3\times \mathbb{T}^3 =
\mathbb{M}, \vect{v}_i : \mathbb{R}_{\geq 0} \to \mathbb{R}^3\times \mathbb{R}^3
= \mathbb{R}^6$, and model the motion of agent $i$ under second order dynamics:

\begin{subequations}
	\begin{align}
    \dot{\vect{x}}_i(t) &= \mat{J}_i(\vect{x}_i) \vect{v}_i(t), \label{eq:system_1} \\
    \vect{u}_i &= \mat{M}_i(\vect{x}_i) \dot{\vect{v}}_i(t) + \mat{C}_i(\vect{x}_i,\dot{\vect{x}}_i) \vect{v}_i(t)+\vect{g}_i(\vect{x}_i), \label{eq:system_2}
	\end{align}
  \label{eq:system}
\end{subequations}

In equation (\ref{eq:system_1}), $\mat{J}_i:\mathbb{M} \to \mathbb{R}^{6\times6}$ is
a Jacobian matrix that maps the Euler angle rates to the orthogonal angular
rates $\vect{v}_i$:

\begin{equation}
  \mat{J}_i(\vect{x}_i) =
  \begin{bmatrix}
    \mat{I}_3 & \mat{0}_{3 \times 3} \\
    \mat{0}_{3 \times 3} & \mat{J}_{ q }(\vect{x}_i) \\
  \end{bmatrix} \notag, \text{ with }
  \mat{J}_q(\vect{x}_i) =
  \begin{bmatrix}
  1 & \sin(\phi_i) \tan(\theta_i)  & \cos(\phi_i) \tan(\theta_i) \\
  0 & \cos(\phi_i) & -\sin(\phi_i) \\
  0  & \displaystyle \frac{\sin(\phi_i)}{\cos(\theta_i)} & \displaystyle \frac{\cos(\phi_i)}{\cos(\theta_i)}
  \end{bmatrix} \notag
\end{equation}

In order for $\mat{J}_i$ to be always well-defined (and hence invertible, since
$\det(\mat{J}_i) = \frac{1}{\cos\theta_i}$) we need to make the following assumption:

\begin{assumption} \label{as:J}
	The angle $\theta_i$ satisfies the inequality
  $$-\frac{\pi}{2} < \theta_i(t) < \frac{\pi}{2} ,\forall i\in\mathcal{V},t\in\mathbb{R}_{\geq 0}$$.
\end{assumption}

In equation (\ref{eq:system_2}), $\mat{M}_i:\mathbb{M} \to \mathbb{R}^{6\times6}$ is
the symmetric and positive definite inertia matrix,
$\mat{C}_i:\mathbb{M}\times\mathbb{R}^6 \to \mathbb{R}^{6\times6}$ is the Coriolis
matrix and $\vect{g}_i:\mathbb{M} \to \mathbb{R}^6$ is the gravity vector.
The aforementioned vector fields are unknown, continuous,
and expressed in the respective coordinate frame of each agent.
Finally, $\vect{u}_i\in\mathbb{R}^6$ is the control input vector representing the $6$D
generalized force acting on the agent. Let us also define the vectors
$\vect{x} = [\vect{x}_1^\top, \dots, x_N^\top]^\top :
\mathbb{R}_{\geq 0} \to \mathbb{M}^N, \vect{v} = [\vect{v}_1^\top, \dots$
and $\vect{v}_N^\top]^\top: \mathbb{R}_{\geq 0} \to \mathbb{R}^{6N}$.

\begin{remark}
	According to \cite{Siciliano2009}, the matrices
  $\dot{\mat{M}}_i - 2\mat{C}_i, i \in \mathcal{V}$ are skew-symmetric.
  From \cite{horn_jonshon}, we have that a quadratic form of a skew-symmetric
  matrix is always equal to $\mat{0}$. Hence, for the matrices
  $\dot{\mat{M}}_i - 2 \mat{C}_i$ it holds that:

	\begin{equation} \label{eq:skew_symm}
	  \vect{y}^\top \left[\dot{\mat{M}}_i - 2 \mat{C}_i\right]\vect{y} = 0, \forall \vect{y} \in \mathbb{R}^n, i \in \mathcal{V}.
	\end{equation}

\end{remark}

\begin{figure}[ht!]
	\centering
	\begin{tikzpicture}[scale = 0.5]
	%draw the global frame
	\draw [color=black,thick,->,>=stealth'](-9, -5) to (-7, -5);
	\draw [color=black,thick,->,>=stealth'](-9, -5) to (-9, -3);
	\draw [color=black,thick,->,>=stealth'](-9, -5) to (-10, -6.5);
	\node at (-9.8, -5.0) {$\{0\}$};

	%draw agent i
	\draw [color = blue, fill = blue!20] (-4.5,0) circle (2.5cm);
  \node at (-5.7, 0.0) {$\{i\}$};
	\draw[green,thick,dashed] (-4.5,0) circle (5.0cm);
	\draw [color=black,thick,->,>=stealth'](-9, -5) to (-4.5, -0.1);
	\node at (-7.7, -3.0) {$p_i$};
	\draw [color=green,thick,dashed,->,>=stealth'](-4.5, 0.0) to (-8.93, 2.43);
	\node at (-7.3, 2.15) {$\bar{d}_i$};
	\draw [color=black,thick,dashed,->,>=stealth'](-4.5, 0.0) to (-2.0, 0.0);
	\node at (-3.3, 0.3) {$r_i$};
	\node at (-4.5, 0.0) {$\bullet$};
	\node at (-4.8, 3.0) {$\mathcal{B}(p_i, r_i)$};

	%draw agent j
	\draw [color = red, fill = red!20] (3.2, 0) circle (1.5cm);
	\node at (2.5, 0.3) {$\{j\}$};
	\draw[orange,thick,dashed,] (3.2, 0) circle (4.1cm);
	\draw [color=black,thick,->,>=stealth'](-9, -5) to (3.2, -0.1);
	\node at (-5.0, -3.9) {$p_j$};
	\draw [color=orange,thick,dashed,->,>=stealth'](3.2, 0.0) to (3.2, -4.0);
	\node at (3.8, -2.7) {$\bar{d}_j$};
	\draw [color=black,thick,dashed,->,>=stealth'](3.2, 0.0) to (4.7, 0.0);
	\node at (4.1, 0.3) {$r_j$};
	\node at (3.2, 0.0) {$\bullet$};
	\node at (3.0, 2.1) {$\mathcal{B}(p_j, r_j)$};

	% draw the obstacle
	\draw [color = black, fill = black!20] (-1, -8) circle (1.2cm);
	\draw [color=black,thick,->,>=stealth'](-9, -5) to (-1.1, -7.98);
	\draw [color=black,thick,dashed,->,>=stealth'](-1, -8) to (-1, -6.8);
	\node at (-1, -8) {$\bullet$};
	\node at (-5.0, -6.0) {$p_{o_z}$};
	\node at (-0.40, -7.5) {$r_{o_z}$};
	\end{tikzpicture}
	\caption{Illustration of two agents $i, j \in \mathcal{V}$ and an static
    obstacle $o_z$ in the workspace; $\{\mathcal{O}\}$ is the inertial frame,
    $\{i\}, \{j\}$ are the frames attached to the agents' center of mass,
    $p_i, p_j, p_{o_z} \in \mathbb{R}^3$ are the positions of the center of mass
    of the agents $i,j$ and the obstacle $o_z$, respectively, with respect to
    $\{\mathcal{O}\}$. $r_i, r_j, r_{o_z}$ are the radii of the agents $i,j$ and
    the obstacle $o_z$ respectively. $\bar{d}_i, \bar{d}_j$ with
    $\bar{d}_i > \bar{d}_j$ are the agents' sensing ranges.}
	\label{fig:agents_geometry}
\end{figure}

It is also further assumed that each agent $i$ can measure its
own $p_i,q_i, \dot{p}_i, v_i, i\in\mathcal{V}$, and has a limited sensing range
of $\bar{d}_i > \max\{r_i+r_j: i,j \in \mathcal{V}\}$. Therefore, by defining
the neighboring set $\mathcal{N}_i(t) = \{j\in\mathcal{V} : p_j(t)\in\mathcal{B}(p_i(t), s_i)\}$,
agent $i$ also knows at each time instant $t$ all $p^i_{j/i}(t), q_{j/i}(t)$
and, since it knows its own $p_i(t),q_i(t)$, it can compute all
$p_{j}(t), q_{j}(t), \forall j\in \mathcal{N}_i(t),t\in\mathbb{R}_{\geq 0}$.

In the workspace there are $|Z|$ static obstacles, modeled as spheres with
centers and radii $p_{o_z}, r_{o_z}\in \mathbb{R}^3, z \in \mathcal{Z} = \{1,\dots,|Z| \}$
, respectively. Thus, the obstacles are modeled by the spheres
$\mathcal{B}(p_{o_z}, r_{o_z}), z \in \{1,\dots,|Z|\}$. The geometry in the
workspace $W$ of agents $i$ and $j$ as well as an obstacle $z$ is depicted in
Fig. \ref{fig:agents_geometry}.

Let us also define the distances:

\begin{subequations}
	\begin{align}
	d_{ij,a} &= \| p_i - p_j \|, i,j \in \mathcal{V}, i \neq j, \label{eq:dij_a}\\
	\underline{d}_{ij, a} &= r_{i} + r_{j}, i,j \in \mathcal{V}, i \neq j, \label{eq:bar_dij_a} \\
	d_{iz,o} &= \| p_i - p_{o_z} \|, i \in \mathcal{V}, z \in \mathcal{Z}, \label{eq:dij_o} \\
	\underline{d}_{iz, o} &= r_{i} + r_{o_z}, i \in \mathcal{V}, z \in \mathcal{Z}, \label{eq:bar_dij_o}
	\end{align}
\end{subequations}

where \eqref{eq:dij_a} stands for the distance between agents $i,j$,
\eqref{eq:bar_dij_a} stands for the minimum distance that two agents do not
collide, \eqref{eq:dij_o} stands for the distance between agent $i$ and
obstacle $z$ and \eqref{eq:bar_dij_o} stands for the minimum distance that
agent $i$ and obstacle $z$ do not collide.

The topology of the multi-agent network is modeled through the graph
$\mathcal{G} = (\mathcal{V},\mathcal{E})$, with $\mathcal{V}=\{1,\dots,N\}$
and $\mathcal{E}=\{\{i,j\}\in\mathcal{V}\times\mathcal{V} : j\in\mathcal{N}_i(0) \text{ and } i\in\mathcal{N}_j(0)\}$.
The latter implies that at $t=0$ the graph is undirected, i.e.,

\begin{equation} \label{eq:initially_connected}
\| p_i(0)-p_j(0) \| < \bar{d}_{i}, \forall i \in \mathcal{V}, j \in \mathcal{N}_i(0).
\end{equation}

We also consider that $\mathcal{G}$ is static in the sense that no edges are
added to the graph. We do not exclude, however, edge removal through
connectivity loss between initially neighboring agents, which we guarantee
to avoid, as presented in the sequel. It is also assumed that at $t=0$ the
neighboring agents are at a collision-free configuration, i.e.,

\begin{equation} \label{eq:initially_coll_free}
\underline{d}_{ij, a} < \| p_i(0)-p_j(0)\|, \forall i,j \in \mathcal{V}, i \neq j.
\end{equation}

Let us define the distance:

\begin{equation*}
D = \min\{d_o, d_{o,W}\},
\end{equation*}

where:

\begin{align*}
d_o &= \min\{\| p_{o_z} - p_{o_{z'}}\| : z,z' \in \mathcal{Z} \}, \\
d_{o,W} &= \min\{r_W - \left( r_{o_z} + \| p_{o_z} \| \right) : z \in \mathcal{Z}\},
\end{align*}

are the distance between the two most closest obstacles and the distance between
the closest obstacle to the boundary with the boundary of the workspace,
respectively. We define the \emph{diameter of formation}, as the maximum
distance between two agents, when the formation is achieved, i.e.:

\begin{align*}
&\hspace{-2mm} \Delta =  \max\{d_{ij, a}+r_i+r_j: i, j \in \mathcal{V}, i \neq j, \notag \\
&\hspace{-2mm} p_k - p_\ell = p_{k \ell,\text{des}}, q_k-q_\ell = q_{k \ell,\text{des}}, k \in \mathcal{V}, \ell \in \mathcal{N}_k(0)\},
\end{align*}

\begin{assumption}
	In order for the problem to be feasible, we make the following natural
  geometric assumptions:

	\begin{itemize}
		\item All the agents should be able to pass between any two the obstacles
      and between an obstacle and the boundary of the workspace, simultaneously,
      and without colliding to each other or with the obstacles as well as the
      boundary of the workspace.
      Thus, it is required $D >  \sum_{i \in \mathcal{V}}^{} 2 r_i$.
		\item When the multi-agent system reach the desired formation, it should be
      able to pass between two of the obstacles and between an obstacle and the
      boundary of the workspace. Thus, it is required $D > \Delta$.
	\end{itemize}

	Both these geometrical assumptions can be summarized in the following
  inequality:

	\begin{equation} \label{eq:geometric_constraint}
	D > \max\left\{\Delta, \sum_{i \in \mathcal{V}}^{} 2 r_i \right\}.
	\end{equation}

\end{assumption}

\subsection{Problem Statement}
Due to the fact that the agents are not dimensionless and their communication
capabilities are limited, the control protocol, except from achieving desired
position formation $p_{ij, \text{des}}$ and desired formation angles
$q_{ij, \text{des}}$ for all neighboring agents
$i \in \mathcal{V}, j \in \mathcal{N}_i(0)$, it should also guarantee for
all $t\in\mathbb{R}_{\geq 0}$ that (i) all the agents avoid collision with
every other agent and (iii) all the initial edges are maintained, i.e.,
connectivity maintenance. Therefore, all the neighboring agents of agent $i$
must remain within distance less than $\bar{d}_{i}$, for all $i \in \mathcal{V}$
and all the agents $i, j\in \mathcal{V}, i \neq j$ must remain within distance
greater than $\underline{d}_{ij,a}$. We also make the following assumption that
are required on the initial graph topology

\begin{assumption}
	The communication graph $\mathcal{G}$ is connected at time $t = 0$ and the
  agents are in collision-free configuration, i.e.,
  both \eqref{eq:initially_connected} and \eqref{eq:initially_coll_free} hold.
\end{assumption}

Formally, the control problem under the aforementioned constraints is
formulated as follows:

\begin{problem} \label{problem}
	Given $N$ agents performing in workspace $W$ modeled as bounded sphere
  $\mathcal{B}(0,r_W)$, with spherical obstacles
  $\mathcal{B}(p_{o_z}, r_{o_z}), z \in \mathcal{Z}$, governed by the dynamics
  \eqref{eq:system}, under the Assumptions 1-3, under the geometric feasibility
  constraint \eqref{eq:geometric_constraint} and given the desired inter-agent
  distances and angles $p_{ij, \text{des}}, q_{ij, \text{des}}$, with
  $\underline{d}_{ij, a} < p_{ij, \text{des}} < \bar{d}_{i}$, $\forall i \in \mathcal{V}, j \in \mathcal{N}_i(0)$,
  design decentralized control laws $u_i \in\mathbb{R}^6,i\in\mathcal{V}$
  such that:

	\begin{itemize}
		\item $\forall i \in \mathcal{V}, j \in \mathcal{N}_i(0)$,
      the following hold:

		$\ 1)$ $\lim\limits_{t \to \infty} \left[ p_{i}(t)-p_{j}(t) - p_{ij, \text{des}} \right] = 0_{3\times1}$,

		$\ 2)$ $\lim\limits_{t \to \infty} \left[q_{i}(t) - q_{j}(t) - q_{ij, \text{des}}\right] = 0_{3\times1}$.

		\item \noindent $\forall i,j \in \mathcal{V}, i \neq j$ the following holds:

		$\ 3)$ $\|p_i(t)-p_j(t)\| > \underline{d}_{ij, a}, \forall \ t \in \mathbb{R}_{\geq 0}$.
		\item $\forall \ i \in \mathcal{V}, z \in \mathcal{Z}$ the following holds:

		$\ 4)$ $\mathcal{B}(p_i(t), r_i) \cap \mathcal{B}(p_{o_z}(t), r_{o_z}) = \emptyset, \forall \ t \in \mathbb{R}_{\geq 0}$.

		\item $\forall i \in \mathcal{V}, j \in \mathcal{N}_i(0)$ the following holds:

		$\ 5)$ $\|p_i(t)-p_j(t)\| < \bar{d}_{i}, \forall \ t \in \mathbb{R}_{\geq 0}$.
	\end{itemize}

\end{problem}

\noindent The aforementioned specifications imply the following:
\begin{itemize}
	\item $1$ stands for formation control;
	\item $2$ stands for orientation alignment;
	\item $3$ stands for inter-agent collision avoidance;
	\item $4$ stands for collision avoidance between the agents and the obstacles;
	\item $5$ stands for connectivity maintenance of the initial graph;
\end{itemize}
